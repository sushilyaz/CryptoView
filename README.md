# CryptoView

Система мониторинга криптовалютных ордербуков для обнаружения аномальных плотностей.

## Описание

CryptoView отслеживает стаканы (orderbook) на 8 криптобиржах и находит аномально крупные лимитные заявки, которые могут указывать на важные ценовые уровни.

### Поддерживаемые биржи

| Биржа | Spot | Futures | Статус |
|-------|------|---------|--------|
| Binance | ✅ | ✅ | Активна |
| Bybit | ✅ | ✅ | Активна |
| OKX | ✅ | ✅ | Активна |
| Bitget | ✅ | ✅ | Активна |
| Gate | ✅ | ✅ | Отключена |
| MEXC | ✅ | ❌ | Активна |
| Hyperliquid | ❌ | ✅ | Активна |
| Lighter | ✅ | ✅ | Требует проверки |

### Типы алертов

1. **VOLUME_BASED** — плотность превышает торговый объём за 15 минут (активируется после 5 мин сбора данных per-symbol)
2. **STATISTICAL** — плотность аномальна статистически (Z-score / IQR) — работает сразу

### Особенности

- Быстрый старт: WebSocket подключается мгновенно (без REST seed)
- Умная дедупликация: max 4 алерта на символ (по side + alertType), cooldown 5 мин
- Telegram rate limiter: очередь сообщений (~20 msg/sec), retry при 429
- Логирование: консоль + файл `logs/cryptoview.log` (rolling, 50MB, 30 дней)

## Требования

- Java 21+
- Gradle 8+
- Telegram Bot Token (для алертов)

## Быстрый старт

### 1. Клонирование
```bash
git clone <repository-url>
cd CryptoView
```

### 2. Конфигурация

Создайте `application.yml` или используйте переменные окружения:

```yaml
cryptoview:
  telegram:
    bot-token: ${TELEGRAM_BOT_TOKEN}
    chat-ids:
      - ${TELEGRAM_CHAT_ID}

  global:
    min-density-usd: 100000
    cooldown-minutes: 5
    max-distance-percent: 10.0
```

### 3. Запуск
```bash
./gradlew bootRun
```

## Конфигурация

### Иерархия настроек

Настройки применяются в порядке приоритета:
1. **Монета** (высший приоритет)
2. **Тип рынка** (spot/futures)
3. **Биржа**
4. **Глобальные** (низший приоритет)

### Пример настройки биржи
```yaml
cryptoview:
  exchanges:
    binance:
      enabled: true
      spot:
        min-density-usd: 150000
      futures:
        min-density-usd: 200000
```

### Настройки монет (symbols-config.json)
```json
{
  "symbols": {
    "BTCUSDT": {
      "comment": "Основная монета",
      "minDensityUsd": 500000,
      "enabled": true
    }
  }
}
```

### Экспорт/Импорт настроек

Настройки монет можно экспортировать в JSON и передать другому пользователю.

## Формат алертов

```
🔴 АНОМАЛЬНАЯ ПЛОТНОСТЬ

📊 BTC/USDT | Binance Futures
📈 Тип: VOLUME_BASED

💰 Объём: $1,250,000
📍 Цена: 65,432.50 (ASK)
📏 От рынка: -2.3%

📊 Объём 15м: $890,000
```

## Архитектура

```
┌─────────────────────────────────────────┐
│           Exchange Connectors           │
│  (Binance, Bybit, OKX, Bitget, ...)    │
└─────────────────┬───────────────────────┘
                  │ WebSocket
                  ▼
┌─────────────────────────────────────────┐
│           OrderBook Manager             │
│     (хранение и обновление стаканов)    │
└─────────────────┬───────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────┐
│           Anomaly Detector              │
│   (VOLUME_BASED + STATISTICAL)          │
└─────────────────┬───────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────┐
│           Alert Service                 │
│    (дедупликация, cooldown)             │
└─────────────────┬───────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────┐
│           Telegram Bot                  │
└─────────────────────────────────────────┘
```

## Структура проекта

```
src/main/java/com/cryptoview/
├── config/          # Конфигурация Spring и приложения
├── model/           # Доменные модели
├── exchange/        # Коннекторы к биржам
│   ├── common/      # Базовые классы
│   ├── binance/
│   ├── bybit/
│   └── ...
├── service/         # Бизнес-логика
│   ├── orderbook/   # Управление стаканами
│   ├── volume/      # Трекинг объёмов
│   ├── detector/    # Детекция аномалий
│   └── alert/       # Алерты и Telegram
└── CryptoViewApplication.java
```

## Производительность

- Обработка до 50,000 сообщений/сек
- Латентность детекции < 100ms
- Потребление RAM: 2-4 GB
- Рекомендуется VPS с хорошим каналом

## Лицензия

MIT

## Документация

- [Техническое задание](TECHNICAL_SPECIFICATION.md)
- [План работ](WORK_PLAN.md)
