# CryptoView ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

## 1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**CryptoView** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–±—É–∫–æ–≤ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π (–∫—Ä—É–ø–Ω—ã—Ö –ª–∏–º–∏—Ç–Ω—ã—Ö –∑–∞—è–≤–æ–∫) –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –±–∏—Ä–∂. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Telegram-–∞–ª–µ—Ä—Ç—ã –∏ real-time API –¥–ª—è React-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

### 1.1 –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–∫–∞–Ω–æ–≤ (orderbook) –Ω–∞ 7 –∫—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∞—Ö
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π –ø–æ –¥–≤—É–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –≤ Telegram
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π (density lifetime tracking)
- REST API –∏ WebSocket —Å—Ç—Ä–∏–º –¥–ª—è React-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- Workspaces ‚Äî –ø—Ä–µ—Å–µ—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ, –ø–æ –±–∏—Ä–∂–µ, –ø–æ —Ç–∏–ø—É —Ä—ã–Ω–∫–∞, –ø–æ –º–æ–Ω–µ—Ç–µ)

### 1.2 –ë–∏—Ä–∂–∏ –∏ —Ç–∏–ø—ã —Ä—ã–Ω–∫–æ–≤

| –ë–∏—Ä–∂–∞ | Spot | Futures | –ö–æ—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è –≤–∞–ª—é—Ç–∞ | –°—Ç–∞—Ç—É—Å |
|-------|------|---------|---------------------|--------|
| Binance | ‚úÖ | ‚úÖ | USDT | –ê–∫—Ç–∏–≤–Ω–∞ |
| Bybit | ‚úÖ | ‚úÖ | USDT | –ê–∫—Ç–∏–≤–Ω–∞ |
| OKX | ‚úÖ | ‚úÖ | USDT | –ê–∫—Ç–∏–≤–Ω–∞ |
| Bitget | ‚úÖ | ‚úÖ | USDT | –ê–∫—Ç–∏–≤–Ω–∞ |
| Gate | ‚úÖ | ‚úÖ | USDT | –û—Ç–∫–ª—é—á–µ–Ω–∞ (—Ç–∞–π–º–∞—É—Ç—ã) |
| MEXC | ‚úÖ | ‚ùå | USDT | –ê–∫—Ç–∏–≤–Ω–∞ (—Ç–æ–ª—å–∫–æ Spot) |
| Hyperliquid | ‚ùå | ‚úÖ | USDC | –ê–∫—Ç–∏–≤–Ω–∞ (perpetual DEX) |
| Lighter | ‚úÖ | ‚úÖ | USDT | –û—Ç–∫–ª—é—á–µ–Ω–∞ |

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 2.1 –î–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö pipeline

–°–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç –¥–≤–∞ data pipeline, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ:

```
Exchange WS Connectors (Binance, Bybit, OKX, Bitget, MEXC, Hyperliquid)
         ‚îÇ                              ‚îÇ
         ‚îÇ OrderBookUpdateEvent         ‚îÇ TradeEvent
         ‚ñº                              ‚ñº
   OrderBookManager                VolumeTracker
   (in-memory ConcurrentHashMap)   (15-min sliding window)
         ‚îÇ                              ‚îÇ
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ              ‚îÇ
         ‚ñº              ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ      Anomaly Detector       ‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ  (Z-score, IQR, Vol-based)  ‚îÇ     ‚îÇ   Density Tracker     ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ (lifetime tracking,   ‚îÇ
             ‚îÇ                        ‚îÇ  ConcurrentHashMap)    ‚îÇ
             ‚îÇ DensityDetectedEvent   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚ñº                                   ‚îÇ
       AlertService                    DensityFilterService
       (dedup, cooldown)               (workspace filtering)
             ‚îÇ                              ‚îÇ           ‚îÇ
             ‚îÇ AlertEvent                   ‚ñº           ‚ñº
             ‚ñº                        REST API    WebSocket —Å—Ç—Ä–∏–º
       TelegramService             /api/v1/...   /ws/densities
       (rate-limited)
```

**Pipeline 1: Alert (Telegram)** ‚Äî `OrderBookUpdateEvent` ‚Üí `AnomalyDetector` ‚Üí `DensityDetectedEvent` ‚Üí `AlertService` ‚Üí `AlertEvent` ‚Üí `TelegramService`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä–æ–≥–∏ –∏–∑ `application.yml` –∏ `symbols-config.json`. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ `{exchange}_{marketType}_{symbol}_{side}_{alertType}` —Å cooldown.

**Pipeline 2: Density Tracking (Frontend)** ‚Äî `OrderBookUpdateEvent` ‚Üí `DensityTracker` ‚Üí `DensityFilterService` ‚Üí REST/WebSocket. –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –í–°–ï –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ > $50K (TRACKING_FLOOR), –≤–µ–¥—ë—Ç lifetime (firstSeenAt/lastSeenAt). –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ workspaces ‚Äî view-layer, –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ pipeline 1.

### 2.2 Event-driven –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–í—Å–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ ‚Äî —á–µ—Ä–µ–∑ Spring Events:

| Event | Publisher | Listeners |
|-------|-----------|-----------|
| `OrderBookUpdateEvent` | OrderBookManager | AnomalyDetector, DensityTracker |
| `TradeEvent` | Exchange Connectors | VolumeTracker |
| `DensityDetectedEvent` | AnomalyDetector | AlertService |
| `AlertEvent` | AlertService | TelegramService |

### 2.3 –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

| –î–∞–Ω–Ω—ã–µ | –•—Ä–∞–Ω–∏–ª–∏—â–µ | Persistence |
|--------|-----------|-------------|
| Orderbooks | `ConcurrentHashMap` | –ù–µ—Ç (in-memory) |
| Volume (15 –º–∏–Ω) | `ConcurrentHashMap<Queue>` | –ù–µ—Ç (in-memory) |
| Tracked Densities | `ConcurrentHashMap` | –ù–µ—Ç (—Å–±—Ä–æ—Å –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ) |
| Workspaces | `ConcurrentHashMap` | `workspaces.json` (–ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç) |
| Symbol configs | `ConcurrentHashMap` | `symbols-config.json` |
| App config | Spring Properties | `application.yml` |

---

## 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 3.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ä–¥–µ—Ä–±—É–∫–æ–≤

#### 3.1.1 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∏—Ä–∂–∞–º
- WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è real-time –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç –ø—Ä–∏ –æ–±—Ä—ã–≤–µ (exponential backoff, max 10 –ø–æ–ø—ã—Ç–æ–∫)
- Ping/pong heartbeat –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
- Stale data detection: –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö 90 —Å–µ–∫ ‚Äî force reconnect
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã
- Virtual threads (Java 21) –¥–ª—è WebSocket –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### 3.1.2 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö **10% –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã**
- –ï—Å–ª–∏ –±–∏—Ä–∂–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ–Ω—å—à–µ 10% –≥–ª—É–±–∏–Ω—ã ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ

#### 3.1.3 –°–±–æ—Ä –æ–±—ä—ë–º–æ–≤
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–±—ä—ë–º–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ **15 –º–∏–Ω—É—Ç** (—Å–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ)
- –û—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏: –±–∏—Ä–∂–∞ + —Ç–∏–ø —Ä—ã–Ω–∫–∞ + –º–æ–Ω–µ—Ç–∞
- –û–±—ä—ë–º—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ WebSocket trade-–ø–æ—Ç–æ–∫–æ–≤ (–±–µ–∑ REST seed)
- VOLUME_BASED –∞–ª–µ—Ä—Ç—ã –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è per-symbol –ø–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è **5 –º–∏–Ω—É—Ç** –¥–∞–Ω–Ω—ã—Ö
- STATISTICAL –∞–ª–µ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 3.2 –î–µ—Ç–µ–∫—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π (Alert Pipeline)

#### 3.2.0 –û–±—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–ø–æ—à–∞–≥–æ–≤–æ)

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞–∫–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è **–∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è —Ü–µ–Ω—ã**:

```
–®–∞–≥ 1: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä (min-density-usd)
‚îÇ   –û–±—ä—ë–º —É—Ä–æ–≤–Ω—è < minDensityUsd?
‚îÇ   ‚îú‚îÄ –î–ê ‚Üí —É—Ä–æ–≤–µ–Ω—å –û–¢–ë–†–û–®–ï–ù, –¥–∞–ª—å—à–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
‚îÇ   ‚îî‚îÄ –ù–ï–¢ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –®–∞–≥—É 2
‚îÇ
–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ VOLUME_BASED (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω)
‚îÇ   –û–±—ä—ë–º —É—Ä–æ–≤–Ω—è > volume15min?
‚îÇ   ‚îú‚îÄ –î–ê ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ ‚Üí –µ—Å–ª–∏ –Ω–µ –¥—É–±–ª–∏–∫–∞—Ç ‚Üí –ê–õ–ï–†–¢
‚îÇ   ‚îî‚îÄ –ù–ï–¢ ‚Üí –Ω–∏—á–µ–≥–æ
‚îÇ
–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ STATISTICAL (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –®–∞–≥–∞ 2)
‚îÇ   –û–±—ä—ë–º —É—Ä–æ–≤–Ω—è > statisticalThreshold?
‚îÇ   ‚îú‚îÄ –î–ê ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ ‚Üí –µ—Å–ª–∏ –Ω–µ –¥—É–±–ª–∏–∫–∞—Ç ‚Üí –ê–õ–ï–†–¢
‚îÇ   ‚îî‚îÄ –ù–ï–¢ ‚Üí –Ω–∏—á–µ–≥–æ
```

**–í–∞–∂–Ω–æ:** `min-density-usd` ‚Äî —ç—Ç–æ –≤—Ö–æ–¥–Ω–æ–π –ø–æ—Ä–æ–≥-—Ñ–∏–ª—å—Ç—Ä. –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –µ–≥–æ –Ω–µ –ø—Ä–æ—à—ë–ª, –Ω–∏ VOLUME_BASED, –Ω–∏ STATISTICAL –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è. –ï—Å–ª–∏ –ø—Ä–æ—à—ë–ª ‚Äî –æ–±–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞** –∏ –º–æ–≥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å **–¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞–ª–µ—Ä—Ç–∞** –Ω–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —É—Ä–æ–≤–µ–Ω—å.

#### 3.2.0.1 –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è min-density-usd (–∫–∞—Å–∫–∞–¥ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤)

–ó–Ω–∞—á–µ–Ω–∏–µ `minDensityUsd` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –∫–∞—Å–∫–∞–¥–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏ (–ø–µ—Ä–≤–æ–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –Ω–µ-null):

```
1. symbols-config.json  (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –º–æ–Ω–µ—Ç–∞, –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
2. application.yml      (marketType: spot/futures –¥–ª—è –±–∏—Ä–∂–∏)
3. application.yml      (exchange: —É—Ä–æ–≤–µ–Ω—å –±–∏—Ä–∂–∏)
4. application.yml      (global: –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Å–∞–º—ã–π –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```

#### 3.2.1 –¢–∏–ø 1: VOLUME_BASED (–ø–æ —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–Ω–æ–º–∞–ª—å–Ω–æ–π, –µ—Å–ª–∏:
```
orderSizeUSD > volume15minUSD
```
–ì–¥–µ:
- `orderSizeUSD` ‚Äî –æ–±—ä—ë–º –ª–∏–º–∏—Ç–Ω–æ–π –∑–∞—è–≤–∫–∏ –≤ USD
- `volume15minUSD` ‚Äî —Å—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ—Ä–≥–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä—ë–º –∑–∞ 15 –º–∏–Ω—É—Ç

#### 3.2.2 –¢–∏–ø 2: STATISTICAL (—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π:

**Z-score –º–µ—Ç–æ–¥:**
```
Œº = —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ –≤ —Å—Ç–∞–∫–∞–Ω–µ
œÉ = —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
Z = (orderSize - Œº) / œÉ
isAnomaly = |Z| > 3
```

**IQR –º–µ—Ç–æ–¥ (–±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤ –∫ –≤—ã–±—Ä–æ—Å–∞–º):**
```
Q1 = 25-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å —Ä–∞–∑–º–µ—Ä–æ–≤ –æ—Ä–¥–µ—Ä–æ–≤
Q3 = 75-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å
IQR = Q3 - Q1
upperBound = Q3 + 3 √ó IQR
isAnomaly = orderSize > upperBound
```

**–ò—Ç–æ–≥–æ–≤—ã–π –ø–æ—Ä–æ–≥:** –±–µ—Ä—ë—Ç—Å—è `min(Z-score threshold, IQR threshold)` –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.

#### 3.2.3 –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤

–ö–ª—é—á –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: `{exchange}_{marketType}_{symbol}_{side}_{alertType}`

Cooldown: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 –º–∏–Ω—É—Ç). –ï—Å–ª–∏ –∞–ª–µ—Ä—Ç —Å —Ç–∞–∫–∏–º –∂–µ –∫–ª—é—á–æ–º —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö cooldown-–ø–µ—Ä–∏–æ–¥–∞, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–ª–µ—Ä—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

**–ê–≥—Ä–µ–≥–∞—Ü–∏—è:** –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Å—Ç–∞–∫–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Ç–æ–ª—å–∫–æ **—Å–∞–º—ã–π –∫—Ä—É–ø–Ω—ã–π** –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ side + alertType. –ú–∞–∫—Å–∏–º—É–º 4 –∞–ª–µ—Ä—Ç–∞ –Ω–∞ —Å–∏–º–≤–æ–ª –∑–∞ –æ–¥–∏–Ω –∞–Ω–∞–ª–∏–∑ —Å—Ç–∞–∫–∞–Ω–∞ (BID_VOLUME_BASED, BID_STATISTICAL, ASK_VOLUME_BASED, ASK_STATISTICAL).

### 3.3 Density Lifetime Tracking (Density Tracking Pipeline)

#### 3.3.1 –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

DensityTracker —Å–ª—É—à–∞–µ—Ç –∫–∞–∂–¥—ã–π `OrderBookUpdateEvent` –∏ –≤–µ–¥—ë—Ç —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –ø–ª–æ—Ç–Ω–æ—Å—Ç–µ–π > $50K:

```
–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:
  activeDensities: ConcurrentHashMap<trackingKey, TrackedDensity>
  densitiesByOrderBookKey: ConcurrentHashMap<orderBookKey, Set<trackingKey>>

trackingKey = "{exchange}_{marketType}_{symbol}_{side}_{price}"
orderBookKey = "{exchange}_{marketType}_{symbol}"
```

#### 3.3.2 –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–∞ –∫–∞–∂–¥—ã–π OrderBookUpdateEvent)

```
1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å orderBookKey
2. –ü–æ–ª—É—á–∏—Ç—å previousKeys –¥–ª—è —ç—Ç–æ–≥–æ orderBookKey
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è bids + asks:
   a. volumeUsd = price √ó quantity
   b. –ï—Å–ª–∏ volumeUsd < TRACKING_FLOOR (50K) ‚Üí skip
   c. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å trackingKey
   d. –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –≤ activeDensities ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å lastSeenAt, quantity, volumeUsd, distancePercent
   e. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π TrackedDensity —Å firstSeenAt = now
   f. –î–æ–±–∞–≤–∏—Ç—å trackingKey –≤ currentKeys
4. –£–¥–∞–ª–∏—Ç—å –∏—Å—á–µ–∑–Ω—É–≤—à–∏–µ: previousKeys - currentKeys ‚Üí remove –∏–∑ activeDensities
5. –û–±–Ω–æ–≤–∏—Ç—å densitiesByOrderBookKey
```

#### 3.3.3 Cleanup

`@Scheduled` –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥: —É–¥–∞–ª–∏—Ç—å `TrackedDensity` —Å `lastSeenAt > 2 –º–∏–Ω` –Ω–∞–∑–∞–¥ (–¥–ª—è —Å–ª—É—á–∞–µ–≤ –∫–æ–≥–¥–∞ –æ—Ä–¥–µ—Ä–±—É–∫ –ø–µ—Ä–µ—Å—Ç–∞–ª –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è).

#### 3.3.4 TrackedDensity

```java
record TrackedDensity(
    String symbol, Exchange exchange, MarketType marketType, Side side,
    BigDecimal price, BigDecimal quantity, BigDecimal volumeUsd,
    BigDecimal distancePercent, BigDecimal lastPrice,
    Instant firstSeenAt, Instant lastSeenAt
)
// durationSeconds() = lastSeenAt - firstSeenAt
```

### 3.4 Workspaces

–†–∞–±–æ—á–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ ‚Äî view-layer —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞. –û–Ω–∏ **–ù–ï –≤–ª–∏—è—é—Ç** –Ω–∞ alert pipeline (Telegram). –¢–æ–ª—å–∫–æ –Ω–∞ –¥–∞–Ω–Ω—ã–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ —á–µ—Ä–µ–∑ REST API –∏ WebSocket.

#### 3.4.1 –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç workspace

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | String (UUID) | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `name` | String | –ù–∞–∑–≤–∞–Ω–∏–µ |
| `active` | boolean | –ê–∫—Ç–∏–≤–Ω—ã–π –ª–∏ (–æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π) |
| `enabledMarkets` | Set\<String\> | –í–∫–ª—é—á—ë–Ω–Ω—ã–µ exchange+marketType (–ø—É—Å—Ç–æ = –≤—Å–µ) |
| `minDensityOverrides` | Map\<String, BigDecimal\> | –ú–∏–Ω. –ø–æ—Ä–æ–≥ –ø–æ exchange_marketType |
| `symbolMinDensityOverrides` | Map\<String, BigDecimal\> | –ú–∏–Ω. –ø–æ—Ä–æ–≥ –ø–æ —Å–∏–º–≤–æ–ª—É |
| `blacklistedSymbols` | Set\<String\> | –°–∫—Ä—ã—Ç—ã–µ —Å–∏–º–≤–æ–ª—ã |
| `symbolComments` | Map\<String, String\> | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–∏–º–≤–æ–ª–∞–º |
| `sortType` | DensitySortType | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (DURATION_DESC, SIZE_USD_DESC, DISTANCE_ASC) |

#### 3.4.2 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è densities –ø–æ workspace

```
allActiveDensities (–∏–∑ DensityTracker)
  ‚Üí filter: exchange+marketType ‚àà enabledMarkets (–∏–ª–∏ –≤—Å–µ, –µ—Å–ª–∏ –ø—É—Å—Ç–æ)
  ‚Üí filter: symbol ‚àâ blacklistedSymbols
  ‚Üí filter: volumeUsd >= resolvedMinDensity(workspace, density)
  ‚Üí enrich: –¥–æ–±–∞–≤–∏—Ç—å comment –∏–∑ workspace.symbolComments
  ‚Üí sort: –ø–æ workspace.sortType
```

#### 3.4.3 –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç resolveMinDensity (–¥–ª—è workspace)

1. `workspace.symbolMinDensityOverrides[symbol]` (–Ω–∞–∏–≤—ã—Å—à–∏–π)
2. `workspace.minDensityOverrides[exchange_marketType]`
3. `configService.getEffectiveConfig()` –∏–∑ application.yml (fallback)

#### 3.4.4 –•—Ä–∞–Ω–µ–Ω–∏–µ

In-memory (`ConcurrentHashMap`) + JSON —Ñ–∞–π–ª `workspaces.json` (–ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç). –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è default workspace.

### 3.5 –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤

#### 3.5.1 –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞
- –ë–∏—Ä–∂–∞ –∏ —Ç–∏–ø —Ä—ã–Ω–∫–∞
- –°–∏–º–≤–æ–ª (—Ç–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞)
- –¢–∏–ø –∞–ª–µ—Ä—Ç–∞ (VOLUME_BASED / STATISTICAL)
- –°—Ç–æ—Ä–æ–Ω–∞ (BID / ASK)
- –¶–µ–Ω–∞ —É—Ä–æ–≤–Ω—è
- –û–±—ä—ë–º –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –≤ USD
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã (%)
- –û–±—ä—ë–º –∑–∞ 15 –º–∏–Ω—É—Ç (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –º–æ–Ω–µ—Ç–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)

#### 3.5.2 Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram Bot API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Markdown)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ chat_id
- **Rate limiter:** –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π (~20 msg/sec, –∏–Ω—Ç–µ—Ä–≤–∞–ª 50–º—Å), retry —Å backoff –ø—Ä–∏ 429
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏: 500 —Å–æ–æ–±—â–µ–Ω–∏–π

### 3.6 –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

#### 3.6.1 –ò–µ—Ä–∞—Ä—Ö–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–æ—Ç –æ–±—â–µ–≥–æ –∫ —á–∞—Å—Ç–Ω–æ–º—É)
1. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ** ‚Äî –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º
2. **–ü–æ –±–∏—Ä–∂–µ** ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –±–∏—Ä–∂–∏
3. **–ü–æ —Ç–∏–ø—É —Ä—ã–Ω–∫–∞** ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏—Ä–∂–∏ –¥–ª—è spot/futures
4. **–ü–æ –º–æ–Ω–µ—Ç–µ** ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –≤—Å–µ –≤—ã—à–µ—Å—Ç–æ—è—â–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–Ω–µ—Ç—ã

#### 3.6.2 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `minDensityUsd` | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –∞–ª–µ—Ä—Ç–∞ | 100,000 |
| `enabled` | –í–∫–ª—é—á–µ–Ω –ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | true |
| `alertTypes` | –¢–∏–ø—ã –∞–ª–µ—Ä—Ç–æ–≤ (VOLUME_BASED, STATISTICAL) | –æ–±–∞ |
| `cooldownMinutes` | –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∞–ª–µ—Ä—Ç–∞–º–∏ –¥–ª—è –æ–¥–Ω–æ–π –º–æ–Ω–µ—Ç—ã | 5 |
| `maxDistancePercent` | –ú–∞–∫—Å. —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ | 10.0 |

---

## 4. REST API

### 4.1 Workspaces

| Method | Path | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| GET | `/api/v1/workspaces` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö workspaces |
| GET | `/api/v1/workspaces/active` | –ê–∫—Ç–∏–≤–Ω—ã–π workspace |
| POST | `/api/v1/workspaces` | –°–æ–∑–¥–∞—Ç—å workspace |
| PUT | `/api/v1/workspaces/{id}` | –û–±–Ω–æ–≤–∏—Ç—å workspace |
| DELETE | `/api/v1/workspaces/{id}` | –£–¥–∞–ª–∏—Ç—å (–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π) |
| POST | `/api/v1/workspaces/{id}/activate` | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workspace |

**–¢–µ–ª–æ POST/PUT –∑–∞–ø—Ä–æ—Å–∞ (WorkspaceRequest):**
```json
{
  "name": "My Workspace",
  "enabledMarkets": ["BINANCE_SPOT", "BINANCE_FUTURES"],
  "minDensityOverrides": {"BINANCE_FUTURES": 500000},
  "symbolMinDensityOverrides": {"BTCUSDT": 1000000},
  "blacklistedSymbols": ["DOGEUSDT"],
  "symbolComments": {"BTCUSDT": "–æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–Ω–µ—Ç–∞"},
  "sortType": "SIZE_USD_DESC"
}
```

### 4.2 Densities

| Method | Path | Query Params | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|--------------|----------|
| GET | `/api/v1/densities` | `sort`, `limit`, `workspaceId` | –ü–ª–æ—Ç–Ω–æ—Å—Ç–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ workspace |

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `sort` ‚Äî `DURATION_DESC`, `SIZE_USD_DESC`, `DISTANCE_ASC` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ workspace)
- `limit` ‚Äî –º–∞–∫—Å. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 200)
- `workspaceId` ‚Äî UUID (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π workspace)

**–û—Ç–≤–µ—Ç (DensityResponse):**
```json
{
  "symbol": "BTCUSDT",
  "exchange": "BINANCE",
  "marketType": "FUTURES",
  "side": "BID",
  "price": 64500.00,
  "quantity": 15.5,
  "volumeUsd": 999750.00,
  "distancePercent": 1.23,
  "lastPrice": 65300.00,
  "firstSeenAt": "2026-02-22T11:55:00Z",
  "lastSeenAt": "2026-02-22T12:00:00Z",
  "durationSeconds": 300,
  "comment": "–∫—Ä—É–ø–Ω—ã–π –±–∏–¥"
}
```

### 4.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–º–≤–æ–ª–æ–≤ (–≤–Ω—É—Ç—Ä–∏ workspace)

| Method | Path | Body | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|------|----------|
| POST | `/api/v1/workspaces/{id}/blacklist/{symbol}` | ‚Äî | –î–æ–±–∞–≤–∏—Ç—å –≤ –ß–° |
| DELETE | `/api/v1/workspaces/{id}/blacklist/{symbol}` | ‚Äî | –£–±—Ä–∞—Ç—å –∏–∑ –ß–° |
| PUT | `/api/v1/workspaces/{id}/symbols/{symbol}/comment` | `{"comment": "..."}` | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
| DELETE | `/api/v1/workspaces/{id}/symbols/{symbol}/comment` | ‚Äî | –£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
| PUT | `/api/v1/workspaces/{id}/symbols/{symbol}/min-density` | `{"minDensity": 500000}` | –ú–∏–Ω. –ø–ª–æ—Ç–Ω–æ—Å—Ç—å |
| DELETE | `/api/v1/workspaces/{id}/symbols/{symbol}/min-density` | ‚Äî | –£–¥–∞–ª–∏—Ç—å override |

### 4.4 –°—Ç–∞—Ç—É—Å

| Method | Path | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| GET | `/api/v1/status` | –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã |

**–û—Ç–≤–µ—Ç:**
```json
{
  "connectedExchanges": 9,
  "totalSymbols": 1250,
  "trackedDensities": 342,
  "activeWorkspace": "Default",
  "activeWorkspaceId": "uuid-here"
}
```

---

## 5. WebSocket API

### 5.1 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```
ws://localhost:8080/ws/densities?workspaceId=<uuid>
```

- Raw WebSocket (–±–µ–∑ STOMP) ‚Äî –∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç native WebSocket API
- –ï—Å–ª–∏ `workspaceId` –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–π workspace —Å–µ—Ä–≤–µ—Ä–∞
- Allowed origins: `http://localhost:3000`

### 5.2 –ü—Ä–æ—Ç–æ–∫–æ–ª

#### –°–º–µ–Ω–∞ workspace (client ‚Üí server)
```json
{"action": "setWorkspace", "workspaceId": "uuid-here"}
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ densities (server ‚Üí client, –∫–∞–∂–¥—ã–µ 500–º—Å)
```json
{
  "type": "densities",
  "timestamp": "2026-02-22T12:00:00Z",
  "count": 42,
  "data": [{ ...DensityResponse... }]
}
```

### 5.3 –ü–æ–≤–µ–¥–µ–Ω–∏–µ

- Broadcast –∫–∞–∂–¥—ã–µ 500–º—Å (scheduled)
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî —Å–≤–æ—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –µ–≥–æ workspace
- –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Äî broadcast –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏–¥–µ–Ω—Ç–∏—á–Ω–∞ REST (`DensityFilterService` ‚Äî shared –ª–æ–≥–∏–∫–∞)
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Äî —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ —É–¥–∞–ª—è–µ—Ç—Å—è

---

## 6. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### 6.1 Backend
- **–Ø–∑—ã–∫:** Java 21 (virtual threads)
- **–§—Ä–µ–π–º–≤–æ—Ä–∫:** Spring Boot 4.0.2
- **–°–±–æ—Ä—â–∏–∫:** Gradle (Groovy DSL)
- **WebSocket (–±–∏—Ä–∂–∏):** OkHttp 4.12.0
- **WebSocket (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥):** Spring WebSocket (raw, –±–µ–∑ STOMP)
- **JSON:** Jackson + JavaTimeModule (ISO-8601)
- **Telegram:** Telegram Bots API 6.9.7.1
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** Apache Commons Math3 3.6.1
- **Protobuf:** Google Protobuf 3.25.3 (MEXC)
- **Env:** springboot4-dotenv

### 6.2 Frontend (–§–∞–∑–∞ 2, –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **–§—Ä–µ–π–º–≤–æ—Ä–∫:** React 18+
- **–Ø–∑—ã–∫:** TypeScript
- **WebSocket:** native WebSocket API
- **UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∞:** TBD

---

## 7. API –±–∏—Ä–∂

### 7.1 Binance
- **Spot WebSocket:** `wss://stream.binance.com:9443/stream` (combined stream)
- **Futures WebSocket:** `wss://fstream.binance.com/stream` (combined stream)
- **Orderbook stream:** `<symbol>@depth20@500ms` (partial depth, 20 —É—Ä–æ–≤–Ω–µ–π)
- **Trade stream:** Spot: `<symbol>@trade`, Futures: `<symbol>@aggTrade`

### 7.2 Bybit
- **Spot WebSocket:** `wss://stream.bybit.com/v5/public/spot`
- **Futures WebSocket:** `wss://stream.bybit.com/v5/public/linear`
- **Orderbook stream:** `orderbook.50.<symbol>` (50 —É—Ä–æ–≤–Ω–µ–π)

### 7.3 OKX
- **WebSocket:** `wss://ws.okx.com:8443/ws/v5/public`
- **Orderbook channel:** `books5` (5 —É—Ä–æ–≤–Ω–µ–π, –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –±–µ–∑ –ª–∏–º–∏—Ç–∞ –ø–æ–¥–ø–∏—Å–æ–∫)
- **Trade channel:** `trades`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ø–æ–¥–ø–∏—Å–∫–∏ orderbook –∏ trades –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ WS-—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### 7.4 Bitget
- **WebSocket:** `wss://ws.bitget.com/v2/ws/public` (API v2)
- **Orderbook channel:** `books15` (15 —É—Ä–æ–≤–Ω–µ–π)
- **Trade channel:** `trade`

### 7.5 Gate (–æ—Ç–∫–ª—é—á–µ–Ω–∞)
- **Spot WebSocket:** `wss://api.gateio.ws/ws/v4/`
- **Futures WebSocket:** `wss://fx-ws.gateio.ws/v4/ws/usdt`
- **–°—Ç–∞—Ç—É—Å:** –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–∑-–∑–∞ SocketTimeoutException –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

### 7.6 MEXC (—Ç–æ–ª—å–∫–æ Spot)
- **WebSocket:** `wss://wbs.mexc.com/ws`
- **–§–æ—Ä–º–∞—Ç:** Protobuf + WebSocket connection pool
- **–ì–ª—É–±–∏–Ω–∞:** –¥–æ 20 —É—Ä–æ–≤–Ω–µ–π

### 7.7 Hyperliquid (—Ç–æ–ª—å–∫–æ Futures)
- **WebSocket:** `wss://api.hyperliquid.xyz/ws`
- **Orderbook:** l2Book subscription per coin
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:** —Ç–æ–ª—å–∫–æ USDC –ø–∞—Ä—ã, perpetual DEX, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≥–ª—É–±–∏–Ω–∞

---

## 8. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 8.1 application.yml (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥)
```yaml
server:
  port: 8080

cryptoview:
  telegram:
    bot-token: ${TELEGRAM_BOT_TOKEN}
    chat-ids:
      - ${TELEGRAM_CHAT_ID}
    enabled: ${TELEGRAM_ENABLED:false}

  global:
    min-density-usd: 100000
    cooldown-minutes: 5
    max-distance-percent: 10.0
    alert-types:
      - VOLUME_BASED
      - STATISTICAL
    enabled: true

  exchanges:
    BINANCE:
      enabled: true
      spot:
        enabled: true
        min-density-usd: 600000
      futures:
        enabled: true
        min-density-usd: 600000
    BYBIT:
      enabled: true
      spot:
        enabled: true
        min-density-usd: 500000
      futures:
        enabled: true
        min-density-usd: 500000
    OKX:
      enabled: true
      spot:
        enabled: true
        min-density-usd: 400000
      futures:
        enabled: true
        min-density-usd: 400000
    BITGET:
      enabled: true
      spot:
        enabled: true
        min-density-usd: 400000
      futures:
        enabled: true
        min-density-usd: 400000
    GATE:
      enabled: false
    MEXC:
      enabled: true
      spot:
        enabled: true
        min-density-usd: 400000
      futures:
        enabled: false
    HYPERLIQUID:
      enabled: true
      futures:
        enabled: true
        min-density-usd: 400000
    LIGHTER:
      enabled: false
```

### 8.2 symbols-config.json (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–µ—Ç)
```json
{
  "symbols": {
    "BTCUSDT": {
      "comment": "–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–Ω–µ—Ç–∞, –≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å",
      "minDensityUsd": 500000,
      "cooldownMinutes": 3,
      "maxDistancePercent": 5.0,
      "alertTypes": ["VOLUME_BASED"],
      "enabled": true
    }
  }
}
```

### 8.3 workspaces.json (workspaces, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```json
[{
  "id": "uuid-here",
  "name": "Default",
  "active": true,
  "enabledMarkets": [],
  "minDensityOverrides": {},
  "symbolMinDensityOverrides": {},
  "blacklistedSymbols": [],
  "symbolComments": {},
  "sortType": "SIZE_USD_DESC"
}]
```

---

## 9. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|-----------|------------|
| `VOLUME_WINDOW_MINUTES` | 15 | VolumeTracker | –û–∫–Ω–æ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –æ–±—ä—ë–º–∞ |
| `MIN_VOLUME_TRACKING_SEC` | 300 (5 –º–∏–Ω) | AnomalyDetector | –ú–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è VOLUME_BASED |
| `DEFAULT_MIN_DENSITY_USD` | 100,000 | ConfigService | –ì–ª–æ–±–∞–ª—å–Ω–∞—è –º–∏–Ω. –ø–ª–æ—Ç–Ω–æ—Å—Ç—å |
| `TRACKING_FLOOR` | 50,000 | DensityTracker | –ú–∏–Ω. –æ–±—ä—ë–º –¥–ª—è lifetime tracking |
| `MAX_DISTANCE_PERCENT` | 10.0 | OrderBookManager | –ú–∞–∫—Å. —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—ã |
| `COOLDOWN_MINUTES` | 5 | AnomalyDetector | –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∞–ª–µ—Ä—Ç–∞–º–∏ |
| `SEND_INTERVAL_MS` | 50 | TelegramService | –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ (~20 msg/sec) |
| `STALE_THRESHOLD` | 2 –º–∏–Ω | DensityTracker | Cleanup –¥–∞–≤–Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö |
| `WS_BROADCAST_INTERVAL` | 500–º—Å | DensityWebSocketHandler | –ò–Ω—Ç–µ—Ä–≤–∞–ª broadcast |
| `Z_SCORE_THRESHOLD` | 3.0 | AnomalyDetector | –ü–æ—Ä–æ–≥ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∞–Ω–æ–º–∞–ª–∏–∏ |
| `IQR_MULTIPLIER` | 3.0 | AnomalyDetector | –ú–Ω–æ–∂–∏—Ç–µ–ª—å IQR |
| `STALE_DATA_THRESHOLD_MS` | 90,000 | AbstractWebSocketConnector | Force reconnect –ø—Ä–∏ –º–æ–ª—á–∞–Ω–∏–∏ |
| `MAX_RECONNECT_ATTEMPTS` | 10 | AbstractWebSocketConnector | –ú–∞–∫—Å. –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞ |
| `PING_INTERVAL_SEC` | 30 | AbstractWebSocketConnector | Heartbeat –∏–Ω—Ç–µ—Ä–≤–∞–ª |

---

## 10. –§–æ—Ä–º–∞—Ç –∞–ª–µ—Ä—Ç–∞ –≤ Telegram

```
üî¥ –ê–ù–û–ú–ê–õ–¨–ù–ê–Ø –ü–õ–û–¢–ù–û–°–¢–¨

üìä BTC/USDT | Binance Futures
üìà –¢–∏–ø: VOLUME_BASED

üí∞ –û–±—ä—ë–º: $1,250,000
üìç –¶–µ–Ω–∞: 65,432.50 (ASK)
üìè –û—Ç —Ä—ã–Ω–∫–∞: -2.3%

üìä –û–±—ä—ë–º 15–º: $890,000
‚è± –í—Ä–µ–º—è: 14:32:15 UTC

üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–Ω–µ—Ç–∞, –≤—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
```

---

## 11. –§–∞–∑—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –§–∞–∑–∞ 1: Backend + Telegram ‚úÖ
- –í—Å–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã –∫ –±–∏—Ä–∂–∞–º (WebSocket)
- OrderBookManager (in-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ)
- VolumeTracker (15-–º–∏–Ω —Å–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ)
- AnomalyDetector (Z-score, IQR, volume-based)
- AlertService (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è, cooldown)
- TelegramService (rate-limited)
- ConfigService (–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (console + file, rolling 50MB/30d)

### –§–∞–∑–∞ 1.5: REST API + WebSocket + Workspaces ‚úÖ
- DensityTracker (lifetime tracking, ConcurrentHashMap)
- DensityFilterService (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ workspace, shared –ª–æ–≥–∏–∫–∞)
- WorkspaceService (CRUD + JSON persistence)
- REST API: workspaces, densities, symbol settings, status
- WebSocket `/ws/densities` (500–º—Å broadcast)
- CORS –¥–ª—è React (localhost:3000)

### –§–∞–∑–∞ 2: Frontend (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –î–∞—à–±–æ—Ä–¥ —Å –ø–ª–æ—Ç–Ω–æ—Å—Ç—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ workspaces
- Blacklist, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ—Ä–æ–≥–∏ —á–µ—Ä–µ–∑ UI
- WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `/ws/densities`

---

## 12. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 12.1 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ 50,000 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫ –æ—Ç –±–∏—Ä–∂
- –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–∫—Ü–∏–∏ < 100ms
- –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ RAM < 4 GB
- WebSocket broadcast —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É: 500–º—Å –∏–Ω—Ç–µ—Ä–≤–∞–ª

### 12.2 –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç –ø—Ä–∏ –æ–±—Ä—ã–≤–µ WebSocket
- Graceful shutdown (ExchangeManager.@PreDestroy)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- workspaces.json –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç

### 12.3 –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –±–∏—Ä–∂–∏
- Workspaces ‚Äî view-layer, –Ω–µ –Ω–∞–≥—Ä—É–∂–∞—é—Ç data pipeline
- DensityTracker cleanup –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç memory leak

---

## 13. –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 13.1 Rate Limits
- –ö–∞–∂–¥–∞—è –±–∏—Ä–∂–∞ –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã –Ω–∞ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–±–ª—é–¥–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∏–Ω–∞—á–µ –±–∞–Ω IP

### 13.2 Hyperliquid
- –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—É—é –≥–ª—É–±–∏–Ω—É —Å—Ç–∞–∫–∞–Ω–∞

### 13.3 Gate
- –û—Ç–∫–ª—é—á–µ–Ω–∞ –∏–∑-–∑–∞ SocketTimeoutException –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

### 13.4 –û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ –≤—Å–µ—Ö –º–æ–Ω–µ—Ç ‚Äî –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è VPS —Å —Ö–æ—Ä–æ—à–∏–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–∫–∞–Ω–∞–ª–æ–º

### 13.5 In-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- Tracked densities —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
- workspaces.json ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π persistent storage
- –ë–î (PostgreSQL) –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ –±—É–¥—É—â–µ–º
